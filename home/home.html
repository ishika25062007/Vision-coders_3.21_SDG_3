<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home | AEROPULSE</title>

  <!-- Google Fonts: Outfit -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="home.css" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Heatmap Plugin -->
  <script src="vendor/leaflet-heat.js"></script>

  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Supabase & Auth -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../logopopup/auth.js"></script>

  <!-- Authentication Check -->
  <script>
    async function checkSession() {
      // Small delay to ensure auth.js initializes supabase
      setTimeout(async () => {
        try {
          const user = await getCurrentUser();
          if (!user) {
            console.warn("ðŸ”’ Access Denied. Redirect disabled for development.");
            // alert("ðŸ”’ Access Denied. Please login to continue.");
            // window.location.replace("../logopopup/logopop.html");
          } else {
            console.log("User authenticated:", user.email);
          }
        } catch (err) {
          console.error("Auth Check Error:", err);
          // Fallback redirect
          // window.location.replace("../logopopup/logopop.html");
        }
      }, 500); // Increased delay slightly to be safe
    }
    checkSession();
  </script>
</head>

<body>

  <!-- ðŸŒŒ Vanta Animated Background (Optional, if you want it here too) -->
  <div id="app-background"></div>

  <!-- ðŸ”¹ NAVBAR -->
  <nav class="navbar">
    <div class="nav-left">
      <img src="image/letter-a.png" alt="Company Logo" class="nav-logo" />
      <span class="brand-name">AEROPULSE</span>
    </div>

    <div class="nav-right">
      <a href="../home/home.html" class="active">Home</a>
      <a href="#">Weather</a>
      <a href="../subcription page/subscription/index1.html">Subscriptions</a>
      <a href="#" onclick="signOut().then(() => window.location.href='../logopopup/logopop.html')">Logout</a>
    </div>
  </nav>

  <!-- ðŸ”¹ HOME TOP SECTION -->
  <section class="home-top">
    <div class="glass-panel top-controls">
      <!-- Search Bar -->
      <div class="search-container">
        <input type="text" placeholder="Search for a city..." class="search-bar" />
        <button class="search-btn">
          <img src="image/search.png" alt="Search" />
        </button>
      </div>

      <!-- Right Buttons -->
      <div class="action-buttons">
        <a href="../location/pages/dashboard.html">
          <button class="glass-btn">Dashboard</button>
        </a>
        <a href="../subcription page/subscription/index1.html" class="api-link">
          <button class="glass-btn glow-btn">
            <img src="image/crown.png" alt="API Icon" class="btn-icon">
            Request API
          </button>
        </a>
      </div>
    </div>
  </section>

  <!-- ðŸŒ Cesium Map Section -->
  <section class="map-section">
    <div id="cesiumContainer" class="map-container"></div>
  </section>

  <!-- ðŸ“Š Bottom Section: Charts & Chatbot -->
  <section class="bottom-grid">

    <!-- Left: AQI Line Chart -->
    <div class="glass-card chart-card">
      <div class="card-header">
        <h3>AQI Trend Analysis</h3>
        <select class="time-filter">
          <option>Last 7 Days</option>
          <option>Last Month</option>
        </select>
      </div>
      <div class="chart-wrapper">
        <canvas id="aqiChart"></canvas>
      </div>
    </div>

    <!-- Right: AI Chatbot -->
    <div class="glass-card chatbot-card">
      <div class="card-header">
        <h3>Aeropulse AI</h3>
        <span class="status-dot"></span>
      </div>

      <div class="chat-messages" id="chat-messages">
        <div class="message bot">
          <div class="msg-content">Hello! I'm your air quality assistant. Ask me about pollution levels or health tips!
          </div>
        </div>
      </div>

      <div class="chat-input-area">
        <input type="text" id="chat-input" placeholder="Ask something..." />
        <button id="send-btn">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
          </svg>
        </button>
      </div>
    </div>

  </section>

  <!-- ðŸ”¹ Custom JS -->
  <script src="../config.js"></script>
  <script src="home.js"></script>
  <!-- Cesium JS -->
  <script src="node_modules/cesium/Build/Cesium/Cesium.js"></script>

</body>

</html>